# ビジネス課題一覧

Dental X-Ray Navigator プロジェクトの現状分析に基づくビジネス課題。

---

## 🔴 緊急度：高（法的・セキュリティリスク）

### 1. 認証・認可システムの不在
- **現状**: Firebase Authentication未使用。clinicId + staffNameの単純フォーム認証のみ
- **リスク**: 任意の認証情報で侵入可能。医院間のデータ分離ができていない
- **影響**: 患者データの漏洩、不正アクセス
- **対応**: Firebase Authentication導入、クリニックごとの認可実装

### 2. 監査証跡（Audit Trail）がない
- **現状**: 誰が何を変更したか追跡する機能がない
- **リスク**: 医療法・個人情報保護法への抵触
- **影響**: 医療事故発生時の原因追跡不可、法的責任問題
- **対応**: 全操作のログ記録機能実装

### 3. Firestore Security Rules未設定
- **現状**: firebase.jsonにHosting設定のみ。セキュリティルールなし
- **リスク**: 全データが読み書き可能な状態
- **影響**: データ改ざん、情報漏洩
- **対応**: 適切なSecurity Rules設定、クリニックIDベースのアクセス制御

### 4. インフォームドコンセント記録なし
- **現状**: X線撮影のリスク説明・患者同意の記録機能がない
- **リスク**: 医療訴訟時の防御困難
- **影響**: 法的リスク
- **対応**: 同意取得・記録フローの追加

### 5. ID生成の脆弱性
- **現状**: `Math.random().toString(36).substr(2, 9)` で生成
- **リスク**: 予測可能、重複可能性あり
- **影響**: データ整合性の破壊
- **対応**: UUID/nanoidライブラリの使用

---

## 🟠 優先度：高（業務継続リスク）

### 6. エラーハンドリングが不十分
- **現状**: alertのみ。Firestore通信エラー処理なし
- **リスク**: 通信失敗時にデータ消失、ユーザーへの通知なし
- **影響**: 業務データの喪失、UX品質低下
- **対応**: try-catch実装、リトライ機構、Toast通知UI

### 7. セッション永続化なし
- **現状**: ページリロードで完全ログアウト
- **リスク**: 実運用で毎回ログインが必要
- **影響**: 業務効率の大幅低下
- **対応**: localStorage/sessionStorageでのセッション保持、Firebase Auth連携

### 8. 診療報酬請求システムとの連携なし
- **現状**: 保険点数計算のみ実装。外部システムとの連携なし
- **リスク**: 請求漏れ、二重請求
- **影響**: 収益損失、コンプライアンス問題
- **対応**: レセプトシステムとの連携機能（CSV/API）

### 9. 承認フロー（ワークフロー）がない
- **現状**: CT等ハイリスク検査も誰でも登録可能
- **リスク**: 医師の確認・承認なしで撮影実施
- **影響**: 医療事故リスク、過剰被曝
- **対応**: 撮影依頼→医師承認→撮影実施のワークフロー実装

### 10. ローディング状態の非表示
- **現状**: `useDentalData`がloadingを返すが未使用
- **リスク**: 通信中にユーザーが操作継続
- **影響**: 二重送信、データ不整合
- **対応**: ローディングインジケーター実装

---

## 🟡 中期的課題（スケーラビリティ・保守性）

### 11. App.tsxの巨大化
- **現状**: 587行の単一コンポーネント、29個のuseState
- **リスク**: 保守性・テスト性の低下
- **影響**: 開発速度低下、バグ混入リスク
- **対応**: コンポーネント分割（RequestForm, TaskList, PatientTable, LogModal）

### 12. データ取得のスケーラビリティ問題
- **現状**: 全patients/requestsをクライアント側で保持
- **リスク**: 1000件超でパフォーマンス悪化
- **影響**: 大規模クリニックで使用不可
- **対応**: ページネーション、Firestoreクエリ最適化

### 13. テストコードがゼロ
- **現状**: ユニットテスト、統合テストなし
- **リスク**: 年齢計算・保険点数計算のバグを検知できない
- **影響**: 医療・金銭に関わる計算ミス
- **対応**: Jest + React Testing Library導入

### 14. オフライン非対応
- **現状**: ネットワーク切断で完全に動作停止
- **リスク**: 通信障害時に業務停止
- **影響**: 緊急時対応不可
- **対応**: Firestore Persistence、Service Worker

### 15. 複数医院対応の未実装
- **現状**: clinicIdでのクエリ絞り込みなし
- **リスク**: 同じ患者IDが複数医院で競合
- **影響**: マルチテナント展開不可
- **対応**: Firestoreのサブコレクション or clinicIdフィールド追加

---

## 📋 機能面の未実装項目

| 機能 | 優先度 | 備考 |
|------|--------|------|
| Firebase Authentication | 高 | セキュリティ基盤 |
| 権限管理（RBAC） | 高 | 医師/技師/受付の役割分け |
| 通知・アラート | 中 | 予定時刻通知、承認待ち通知 |
| レポート・エクスポート | 中 | CSV/PDF出力、月次レポート |
| 変更履歴表示 | 中 | 依頼内容の変更追跡 |
| 多言語対応 | 低 | UI文字列が日本語ハードコード |
| ユーザー設定画面 | 低 | デフォルト値、表示設定 |

---

## 📊 現在の実装状態サマリー

```
機能実装度:     ████████░░ 80%
本番運用可能性: ███░░░░░░░ 30%
セキュリティ:   ██░░░░░░░░ 20%
テストカバレッジ: ░░░░░░░░░░ 0%
```

---

## 🎯 推奨対応順序

### Phase 1: セキュリティ基盤（必須）
1. Firebase Authentication導入
2. Firestore Security Rules設定
3. 監査ログ機能追加
4. ID生成の修正（UUID化）

### Phase 2: 業務安定性
5. エラーハンドリング強化
6. セッション永続化
7. ローディング状態表示
8. 承認ワークフロー

### Phase 3: スケーラビリティ
9. App.tsx分割リファクタリング
10. ページネーション実装
11. テストコード追加

### Phase 4: 機能拡張
12. レポート・エクスポート
13. 診療報酬システム連携
14. オフライン対応

---

*最終更新: 2026-02-05*
